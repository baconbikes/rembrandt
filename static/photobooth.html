<html>
<head>
<style type="text/css">
#camera {
  display: block;
  margin-left: auto;
  margin-right: auto;
  height: 600px;
  width: 800px;
  padding: 10px;
}
div#credits {
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-top: 20px;
  text-align: center;
}
</style>
<script type="text/javascript" src="jquery.2.1.3.min.js"></script>
<script type="text/javascript" src="photobooth.0.7_min.js"></script>
<script type="text/javascript">

function consume_credit() {
  $.post("/consume_credit")
}

function has_credit() {
  return (parseInt($('span#credits').text()) > 0)
}

function take_photo() {
  $('li.trigger').click()
  consume_credit()
}

function joystick() {

  $.get("/keystrokes", function(x) {
    var data = JSON.parse(x)
    console.log(data)

    $('span#credits').text(data.credits) // handle credits

    console.log(data.pressed)

    for (press in data.pressed) {
      if (data.pressed[press] == "ok") {
        if (has_credit()) {
          take_photo();
        }
      }
    }

    setTimeout(joystick, 2500)
  })
}

$(document).ready(function() {
  $('#camera').photobooth().on("image", function (event, dataUrl) {})
  joystick();
});

</script>
</head>
<body>
<div id="page_camera"</div>
<div id="camera"></div>
<div id="credits">You have <span id="credits">0</span> credits remaining.</div>
</div>
</body>
</html>